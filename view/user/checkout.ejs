<%- include('../layout/pagesHeader') %>

    <head>

        <head>
            <!-- Other meta tags and stylesheets -->
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


        </head>

        <style>
            .labl {
                display: block;
                width: 400px;
            }

            .labl>input {
                /* HIDE RADIO */
                visibility: hidden;
                /* Makes input not-clickable */
                position: absolute;
                /* Remove input from document flow */
            }

            .labl>input+div {
                /* DIV STYLES */
                cursor: pointer;
                border: 2px solid transparent;

            }

            .labl>input:checked+div {
                /* (RADIO CHECKED) DIV STYLES */
                background-color: #f3f3f3;
                border: 2px solid #bf8040;
            }

            .address {
                display: flex;

            }
        </style>
    </head>

    <main class="main">
        <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
            <div class="container">
                <h1 class="page-title">Checkout<span>Shop</span></h1>
            </div><!-- End .container -->
        </div><!-- End .page-header -->
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <div class="container">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/products">Shop</a></li>
                    <li class="breadcrumb-item"><a href="/cart">Cart</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                </ol>
            </div><!-- End .container -->
        </nav><!-- End .breadcrumb-nav -->

        <div class="page-content">
            <div class="checkout">
                <div class="container">
                    <div class="checkout-discount">
                        <button type="button" class="btn text-warning" data-toggle="modal"
                            data-target=".bd-example-modal-lg">Click here to see your currunt coupons</button>


                        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
                            aria-labelledby="myLargeModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Available Coupons</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="p-4 pt-0">

                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Coupon Code</th>
                                                        <th>Discount Price</th>
                                                        <th>Expire Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody>

                                                    <% coupon.forEach((coupon)=>{ %>

                                                        <%if(!coupon){ %>
                                                            <p>coupon is empty</p>
                                                            <% }%>

                                                                <tr>
                                                                    <td>
                                                                        <%=coupon.Couponcode%>
                                                                    </td>
                                                                    <td>$<%=coupon.discount%> off</td>
                                                                    <td>
                                                                        <%= new Date(coupon.expiry).toDateString() %>
                                                                    </td>

                                                                </tr>

                                                                <!-- Add more coupon details as needed -->
                                                                <% })%>
                                                </tbody>
                                            </table>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <form action="/applyCoupon" method="post">
                            <!-- <input type="text" class="form-control" required id="checkout-discount-input" name="couponCode" >
            					<label for="checkout-discount-input m-0" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
                               -->

                            <div class="form-group ">
                                <label for="inputPassword2" class="sr-only">Password</label>
                                <input type="text" class="form-control mb-1 p-0" id="inputPassword2"
                                    placeholder="Click here to enter your code" name="couponCode">


                                <button type="submit" class="btn btn-primary mb-2">Apply</button>
                        </form>
                    </div>



                    <div id="appliedCouponDiv" class="border p-2 d-flex align-items-center justify-content-between"
                        style="border: 1px solid rgb(227, 212, 0);">
                        <% if (cart.appliedCoupon) { %>
                            <p style="margin: 0;"> Applied Coupon:<span>
                                    <%= cart.appliedCoupon %>
                                </span></p>
                            <a href="/removeCoupon?CouponCode=<%=cart.appliedCoupon%>"><button class="btn-remove"><i
                                        class="icon-close"></i></button></a>
                            <% } else { %>
                                <p>No coupon applied</p>
                                <% } %>
                    </div>

                </div><!-- End .checkout-discount -->




                <div class="row">
                    <div class="col-lg-9">
                        <!-- <h4 class="checkout-title"> add New Address?? <a href="/dashBoard">click here..</a></h4>	 -->
                        <div id="ModalLoginForm" class="modal fade">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h2 class="checkout-title">Billing Details</h2>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>

                                    </div>
                                    <div class="modal-body">

                                        <form id="addressForm" role="form" method="POST" action="/address">
                                            <input type="hidden" name="_token" value="">
                                            <div class="form-group">

                                                <div class="p-5">



                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label for="name">First Name *</label>
                                                            <input name="name" id="name" type="text"
                                                                class="form-control"
                                                                oninput="clearErrorMessage('nameError')">
                                                            <span id="nameError" class="text-danger"></span>
                                                        </div><!-- End .col-sm-6 -->


                                                        <div class="col-sm-6">
                                                            <label>Phone *</label>
                                                            <input name="phone" type="text" class="form-control"
                                                                id="phone">
                                                            <span id="phoneError" class="text-danger"></span>
                                                        </div><!-- End .col-sm-6 -->
                                                    </div><!-- End .row -->


                                                    <label>Street address *</label>
                                                    <input name="street" type="text" class="form-control" id="street"
                                                        placeholder="Street name"
                                                        oninput="clearErrorMessage('streetError')">
                                                    <span id="streetError" class="text-danger"></span><br>
                                                    <label>House Number *</label>
                                                    <input name="houseNum" type="text" class="form-control"
                                                        id="houseNum" placeholder="House number ">
                                                    <span id="houseNumError" class="text-danger"></span><br>

                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label>Town / City *</label>
                                                            <input name="city" type="text" id="city"
                                                                class="form-control"
                                                                oninput="clearErrorMessage('cityError')">
                                                            <span id="cityError" class="text-danger"></span><br>
                                                        </div><!-- End .col-sm-6 -->

                                                        <div class="col-sm-6">
                                                            <label>State / Country *</label>
                                                            <input name="country" type="text" id="country"
                                                                class="form-control">
                                                            <span id="countryError" class="text-danger"
                                                                oninput="clearErrorMessage('countryError')"></span><br>
                                                        </div><!-- End .col-sm-6 -->
                                                    </div><!-- End .row -->

                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <label>Postcode / ZIP *</label>
                                                            <input name="pincode" type="text" id="pincode"
                                                                class="form-control">
                                                            <span id="pincodeError" class="text-danger"></span><br>
                                                        </div><!-- End .col-sm-6 -->

                                                        <div class="col-sm-6">
                                                            <label>Landmark *</label>
                                                            <input name="landmark" type="tel" id="landmark"
                                                                class="form-control"
                                                                oninput="clearErrorMessage('landmarkError')">
                                                            <span id="landmarkError" class="text-danger"></span><br>
                                                        </div><!-- End .col-sm-6 -->
                                                    </div><!-- End .row -->



                                                    <label>Email address *</label>
                                                    <input name="email" type="email" class="form-control" id="email"
                                                        oninput="clearErrorMessage('emailError')">
                                                    <span id="emailError" class="text-danger"></span><br>


                                                    <div>
                                                        <button type="submit" onclick="validateAddressForm()"
                                                            class="btn btn-success">
                                                            Add
                                                        </button>
                                                    </div>

                                                </div>

                                            </div>
                                        </form>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->
                        <button type="button" class="btn btn-outline-primary btn-rounded" data-toggle="modal"
                            data-target="#ModalLoginForm">
                            Add new address
                        </button>



                        <h2 class="checkout-title">Select Addresses *</h2><!-- End .checkout-title -->

                        <div class="address col-lg-12">
                            <div class="row " style="gap: 10px ;">

                                <% address.forEach((item)=>{ %>


                                    <label class="labl ">
                                        <input type="radio" name="radioname" value="one_value" checked="checked"
                                            onclick="selectAddress('<%=item._id%>')" />
                                        <div class="card card-dashboard">
                                            <div class="card-body">
                                                <h3 class="card-title">Billing Address</h3><!-- End .card-title -->
                                                <p>
                                                    <%=item.name%>
                                                </p>
                                                <p>
                                                    <%=item.phone%><br>
                                                        <%=item.email%><br>
                                                            <%=item.houseNo%><br>
                                                                <%=item.street%><br>
                                                                    <%=item.landmark%><br>
                                                                        <%=item.pincode%><br>
                                                                            <%=item.city%> <br>
                                                                                <%=item.country%><br>
                                                                                    <a class="text-danger "
                                                                                        onclick="deleteAddress('<%=item._id%>')">Remove
                                                                                        <i class="icon-close"></i></a>
                                                </p>
                                            </div><!-- End .card-body -->
                                        </div><!-- End .card-dashboard -->
                                    </label>

                                    <% }) %>

                            </div>

                        </div>











                    </div><!-- End .col-lg-9 -->




                    <div class="col-lg-3">
                        <div class="summary">
                            <h3 class="summary-title">Your Order</h3><!-- End .summary-title -->

                            <table class="table table-summary">
                                <thead>
                                    <tr>
                                        <th>Product</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>


                                <tbody>


                                    <% cart.products.forEach((item)=>{ %>

                                        <tr>
                                            <td><a href="#">
                                                    <%=item.product.name%>
                                                </a></td>
                                            <td>₹<%=item.subTotal%>.00</td>
                                        </tr>

                                        <% })%>

                                            <tr class="summary-subtotal">
                                                <td>Subtotal:</td>
                                                <td>₹<%=cart.Total%>.00</td>


                                            </tr><!-- End .summary-subtotal -->


                                            <tr>
                                                <td>Shipping:</td>
                                                <td>Free shipping</td>
                                            </tr>
                                            <tr class="summary-total">
                                                <td>Total:</td>
                                                <td>₹<%=cart.Total%>.00</td>

                                            </tr><!-- End .summary-total -->


                                </tbody>

                            </table><!-- End .table table-summary -->

                            <div class="accordion-summary" id="accordion-payment">




                                <div class="card">
                                    <div class="card-header" id="heading-3">
                                        <h2 class="card-title">
                                            <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3"
                                                aria-expanded="false" aria-controls="collapse-3"
                                                onclick="selectPeyment('Pay on Delivery (Cash/Card).')">
                                                Cash on delivery
                                            </a>
                                        </h2>
                                    </div><!-- End .card-header -->
                                    <div id="collapse-3" class="collapse" aria-labelledby="heading-3"
                                        data-parent="#accordion-payment">
                                        <div class="card-body">Quisque volutpat mattis eros. Lorem ipsum dolor sit amet,
                                            consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros.
                                        </div><!-- End .card-body -->
                                    </div><!-- End .collapse -->
                                </div><!-- End .card -->



                                <div class="card">
                                    <div class="card-header" id="heading-4">
                                        <h2 class="card-title">
                                            <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-4"
                                                aria-expanded="false" aria-controls="collapse-4"
                                                onclick="selectPeyment('razorPay')">
                                                Razorpay <small class="float-right paypal-link">What is
                                                    RazorPay?</small>
                                            </a>
                                        </h2>
                                    </div><!-- End .card-header -->
                                    <div id="collapse-4" class="collapse" aria-labelledby="heading-4"
                                        data-parent="#accordion-payment">
                                        <div class="card-body">
                                            Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper
                                            suscipit, posuere a, pede. Donec nec justo eget felis facilisis fermentum.
                                        </div><!-- End .card-body -->
                                    </div><!-- End .collapse -->
                                </div><!-- End .card -->

                                <div class="card">
                                    <div class="card-header" id="heading-5">
                                        <h2 class="card-title">
                                            <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-5"
                                                aria-expanded="false" aria-controls="collapse-5"
                                                onclick="selectPeyment('wallet')">
                                                Personal Wallet
                                                <img src="assets/images/payments-summary.png" alt="payments cards">
                                            </a>
                                        </h2>
                                        <span class="text-danger">
                                            <%=message%>
                                        </span>
                                    </div><!-- End .card-header -->
                                    <div id="collapse-5" class="collapse" aria-labelledby="heading-5"
                                        data-parent="#accordion-payment">
                                        <div class="card-body"> Donec nec justo eget felis facilisis fermentum.Lorem
                                            ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque
                                            volutpat mattis eros. Lorem ipsum dolor sit ame.
                                        </div><!-- End .card-body -->
                                    </div><!-- End .collapse -->
                                </div><!-- End .card -->
                            </div><!-- End .accordion -->

                            <button type="submit" class="btn btn-outline-primary-2 btn-order btn-block"
                                onclick="orderConfirm()">
                                <span class="btn-text">Place Order</span>
                                <span class="btn-hover-text">Proceed to Checkout</span>
                            </button>
                        </div><!-- End .summary -->
                        </aside><!-- End .col-lg-3 -->
                    </div><!-- End .row -->



                </div><!-- End .container -->
            </div><!-- End .checkout -->
        </div><!-- End .page-content -->
    </main><!-- End .main -->

    <footer class="footer">
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-lg-3">
                        <div class="widget widget-about">
                            <img src="assets/images/logo.png" class="footer-logo" alt="Footer Logo" width="105"
                                height="25">
                            <p>Praesent dapibus, neque id cursus ucibus, tortor neque egestas augue, eu vulputate magna
                                eros eu erat. </p>

                            <div class="social-icons">
                                <a href="#" class="social-icon" target="_blank" title="Facebook"><i
                                        class="icon-facebook-f"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Twitter"><i
                                        class="icon-twitter"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Instagram"><i
                                        class="icon-instagram"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Youtube"><i
                                        class="icon-youtube"></i></a>
                                <a href="#" class="social-icon" target="_blank" title="Pinterest"><i
                                        class="icon-pinterest"></i></a>
                            </div><!-- End .soial-icons -->
                        </div><!-- End .widget about-widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Useful Links</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="about.html">About Molla</a></li>
                                <li><a href="#">How to shop on Molla</a></li>
                                <li><a href="#">FAQ</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="login.html">Log in</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">Customer Service</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Payment Methods</a></li>
                                <li><a href="#">Money-back guarantee!</a></li>
                                <li><a href="#">Returns</a></li>
                                <li><a href="#">Shipping</a></li>
                                <li><a href="#">Terms and conditions</a></li>
                                <li><a href="#">Privacy Policy</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->

                    <div class="col-sm-6 col-lg-3">
                        <div class="widget">
                            <h4 class="widget-title">My Account</h4><!-- End .widget-title -->

                            <ul class="widget-list">
                                <li><a href="#">Sign In</a></li>
                                <li><a href="cart.html">View Cart</a></li>
                                <li><a href="#">My Wishlist</a></li>
                                <li><a href="#">Track My Order</a></li>
                                <li><a href="#">Help</a></li>
                            </ul><!-- End .widget-list -->
                        </div><!-- End .widget -->
                    </div><!-- End .col-sm-6 col-lg-3 -->
                </div><!-- End .row -->
            </div><!-- End .container -->
        </div><!-- End .footer-middle -->

        <div class="footer-bottom">
            <div class="container">
                <p class="footer-copyright">Copyright © 2019 Molla Store. All Rights Reserved.</p>
                <!-- End .footer-copyright -->
                <figure class="footer-payments">
                    <img src="assets/images/payments.png" alt="Payment methods" width="272" height="20">
                </figure><!-- End .footer-payments -->
            </div><!-- End .container -->
        </div><!-- End .footer-bottom -->
    </footer><!-- End .footer -->
    </div><!-- End .page-wrapper -->
    <button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <!-- Mobile Menu -->
    <!-- End .mobile-nav -->

    <div class="social-icons">
        <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
        <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
        <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
        <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
    </div><!-- End .social-icons -->
    </div><!-- End .mobile-menu-wrapper -->
    </div><!-- End .mobile-menu-container -->

    <!-- Sign in / Register Modal -->
    <div class="modal fade" id="signin-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"><i class="icon-close"></i></span>
                    </button>

                    <div class="form-box">
                        <div class="form-tab">
                            <ul class="nav nav-pills nav-fill" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="signin-tab" data-toggle="tab" href="#signin"
                                        role="tab" aria-controls="signin" aria-selected="true">Sign In</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="register-tab" data-toggle="tab" href="#register" role="tab"
                                        aria-controls="register" aria-selected="false">Register</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="tab-content-5">
                                <div class="tab-pane fade show active" id="signin" role="tabpanel"
                                    aria-labelledby="signin-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="singin-email">Username or email address *</label>
                                            <input type="text" class="form-control" id="singin-email"
                                                name="singin-email">
                                        </div><!-- End .form-group -->

                                        <div class="form-group">
                                            <label for="singin-password">Password *</label>
                                            <input type="password" class="form-control" id="singin-password"
                                                name="singin-password">
                                        </div><!-- End .form-group -->

                                        <div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>LOG IN</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input"
                                                    id="signin-remember">
                                                <label class="custom-control-label" for="signin-remember">Remember
                                                    Me</label>
                                            </div><!-- End .custom-checkbox -->

                                            <a href="#" class="forgot-link">Forgot Your Password?</a>
                                        </div><!-- End .form-footer -->
                                    </form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><!-- End .col-6 -->
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div><!-- End .col-6 -->
                                        </div><!-- End .row -->
                                    </div><!-- End .form-choice -->
                                </div><!-- .End .tab-pane -->
                                <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="register-email">Your email address *</label>
                                            <input type="email" class="form-control" id="register-email"
                                                name="register-email">
                                        </div><!-- End .form-group -->

                                        <div class="form-group">
                                            <label for="register-password">Password *</label>
                                            <input type="password" class="form-control" id="register-password"
                                                name="register-password">
                                        </div><!-- End .form-group -->

                                        <div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>SIGN UP</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input"
                                                    id="register-policy">
                                                <label class="custom-control-label" for="register-policy">I agree to the
                                                    <a href="#">privacy policy</a> *</label>
                                            </div><!-- End .custom-checkbox -->
                                        </div><!-- End .form-footer -->
                                    </form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><!-- End .col-6 -->
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login  btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div><!-- End .col-6 -->
                                        </div><!-- End .row -->
                                    </div><!-- End .form-choice -->
                                </div><!-- .End .tab-pane -->
                            </div><!-- End .tab-content -->
                        </div><!-- End .form-tab -->
                    </div><!-- End .form-box -->
                </div><!-- End .modal-body -->
            </div><!-- End .modal-content -->
        </div><!-- End .modal-dialog -->
    </div><!-- End .modal -->

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <script>

        function clearErrorMessage(inputId) {
            const errorElement = document.getElementById(inputId);
            errorElement.style.display = 'none'; // Hide error message when input is provided
        }


        function validateName() {
            const name = document.getElementById('name').value.trim();
            const nameError = document.getElementById('nameError');

            if (!name) {
                nameError.textContent = 'Please enter your first name.';
                return false;
            } else {
                nameError.textContent = '';
                return true;
            }
        }


        function validatePhone() {
            const phone = document.getElementById('phone').value.trim();
            const phoneError = document.getElementById('phoneError');
            const phoneRegex = /^\d{10}$/; // Regular expression for 10 digits
            const numericRegex = /^[0-9]+$/; // Regular expression for numeric characters

            if (!phone) {
                phoneError.textContent = 'Please enter your phone number.';
                return false;
            } else if (!numericRegex.test(phone)) {
                phoneError.textContent = 'Phone number should contain only numbers.';
                return false;
            } else if (!phoneRegex.test(phone)) {
                phoneError.textContent = 'Phone number should be 10 digits.';
                return false;
            } else {
                phoneError.textContent = '';
                return true;
            }
        }

        function validateStreet() {
            const street = document.getElementById('street').value.trim();
            const streetError = document.getElementById('streetError');
            const alphanumericRegex = /^[a-zA-Z0-9\s,.'-]*$/; // Regular expression for alphanumeric characters and some special characters commonly found in street addresses

            if (!street) {
                streetError.textContent = 'Please enter your street address.';
                return false;
            } else if (!alphanumericRegex.test(street)) {
                streetError.textContent = 'Please enter a valid street address.';
                return false;
            } else {
                streetError.textContent = '';
                return true;
            }
        }

        function validateHouseNumber() {
            const houseNum = document.getElementById('houseNum').value.trim();
            const houseNumError = document.getElementById('houseNumError');
            const numberRegex = /^[0-9]+$/;

            if (!houseNum) {
                houseNumError.textContent = 'Please enter your house number.';
                return false;
            } else if (!numberRegex.test(houseNum)) {
                houseNumError.textContent = 'Please enter a valid house number containing only numbers.';
                return false;
            } else {
                houseNumError.textContent = '';
                return true;
            }
        }

        function validateCity() {
            const city = document.getElementsByName('city')[0].value.trim();
            const cityError = document.getElementById('cityError');
            const cityRegex = /^[a-zA-Z\s]+$/; // Regex to allow only letters and spaces

            if (!city) {
                cityError.textContent = 'Please enter the town/city.';
                return false;
            } else if (!cityRegex.test(city)) {
                cityError.textContent = 'Please enter a valid town/city name containing only letters and spaces.';
                return false;
            } else {
                cityError.textContent = '';
                return true;
            }
        }

        function validateCountry() {
            const country = document.getElementsByName('country')[0].value.trim();
            const countryError = document.getElementById('countryError');
            const countryRegex = /^[a-zA-Z\s]+$/; // Regex to allow only letters and spaces

            if (!country) {
                countryError.textContent = 'Please enter the state/country.';
                return false;
            } else if (!countryRegex.test(country)) {
                countryError.textContent = 'Please enter a valid state/country name containing only letters and spaces.';
                return false;
            } else {
                countryError.textContent = '';
                return true;
            }
        }

        function validatePincode() {
            const pincode = document.getElementsByName('pincode')[0].value.trim();
            const pincodeError = document.getElementById('pincodeError');
            const pincodeRegex = /^[0-9]+$/; // Regex to allow only digits (numbers)

            if (!pincode) {
                pincodeError.textContent = 'Please enter the pincode/ZIP.';
                return false;
            } else if (!pincodeRegex.test(pincode)) {
                pincodeError.textContent = 'Please enter a valid pincode/ZIP containing only numbers.';
                return false;
            } else {
                pincodeError.textContent = '';
                return true;
            }
        }



        function validateEmail() {
            const email = document.getElementsByName('email')[0].value.trim();
            const emailError = document.getElementById('emailError');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Regex to validate email format

            if (!email) {
                emailError.textContent = 'Please enter your email address.';
                return false;
            } else if (!emailRegex.test(email)) {
                emailError.textContent = 'Please enter a valid email address.';
                return false;
            } else {
                emailError.textContent = '';
                return true;
            }
        }

        function validateLandmark() {
            const landmark = document.getElementsByName('landmark')[0].value.trim();
            const landmarkError = document.getElementById('landmarkError');

            if (!landmark) {
                landmarkError.textContent = 'Please enter the landmark.';
                return false;
            } else {
                landmarkError.textContent = '';
                return true;
            }
        }





        // Create similar functions for other form fields (e.g., street, house number, etc.)

        function validateAddressForm() {
            const isNameValid = validateName();
            const isPhoneValid = validatePhone();
            const isStreetValid = validateStreet();
            const isHouseValid = validateHouseNumber();
            const isvalidateCity = validateCity();
            const isvalidateCountry = validateCountry();
            const isvalidatePincode = validatePincode();
            const isvalidateEmail = validateEmail();
            const isvalidateLandmark = validateLandmark();

            // Call other validation functions and assign results to respective variables

            if (isNameValid && isPhoneValid && isStreetValid && isHouseValid &&
                isvalidateCity && isvalidateCountry && isvalidatePincode && isvalidateEmail &&
                isvalidateLandmark
            ) {
                // Perform other actions or submit the form
                // Example: document.getElementById('yourFormId').submit();
            }
        }

        






        async function deleteAddress(addresId) {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, delete it!"
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        const response = await fetch(`/deleteAddress?address=${addresId}`, {
                            method: 'GET'
                        });

                        if (response.ok) {
                            await Swal.fire({
                                title: "Deleted!",
                                text: "Your file has been deleted.",
                                icon: "success"
                            });
                            window.location.reload();
                        } else {
                            await Swal.fire({
                                title: "Failed to delete!",
                                text: "Your file is not deleted.",
                                icon: "error"
                            });
                            // Optionally handle response message here
                            const data = await response.json();
                            alert(data.message);
                        }
                    } catch (error) {
                        console.error('Error occurred:', error);
                        Swal.fire({
                            title: "Error",
                            text: "An error occurred while deleting the address.",
                            icon: "error"
                        });
                    }
                }
            });


        }

        document.getElementById('addressForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const name = document.getElementsByName('name')[0].value;
            const phone = document.getElementsByName('phone')[0].value;
            const email = document.getElementsByName('email')[0].value;
            const houseNum = document.getElementsByName('houseNum')[0].value;
            const street = document.getElementsByName('street')[0].value;
            const landmark = document.getElementsByName('landmark')[0].value;
            const pincode = document.getElementsByName('pincode')[0].value;
            const city = document.getElementsByName('city')[0].value;
            const country = document.getElementsByName('country')[0].value;

            // Construct the data object with form field values
            const formData = {
                name: name,
                phone: phone,
                email: email,
                houseNo: houseNum,
                street: street,
                landmark: landmark,
                pincode: pincode,
                city: city,
                country: country
            };

            fetch('/address', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/checkout';
                    } else {
                        console.error("failed add to address")
                    }
                })
                .catch(error => {
                    console.error(error)
                })
        });

        let addressId = '';
        let PaymentMethod = '';

        function selectAddress(id) {

            addressId = id;
        }

        function selectPeyment(payment) {

            PaymentMethod = payment;

        }

        async function orderConfirm() {


            const confirmed = await Swal.fire({
                title: 'Confirm Order',
                text: "are you sure you want procced with the order ",
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes ',
                cancelButtonText: 'No, cancel',

            });


            if (confirmed.isConfirmed) {
                try {
                    const response = await fetch('/orderConfirm', {
                        method: 'post',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ addressId, PaymentMethod })
                    })

                    if (response.ok) {
                        if (response.status === 200) {
                            alert(response.status);
                            await Swal.fire('Success', 'Order Placed succesfully ', 'success')
                            window.location.href = '/success-page'
                        }

                        else if (response.status === 201) {
                            try {
                                const responseData = await response.json();
                                const { orderId, amount, currency } = responseData; // Extract order details from the response

                                const options = {
                                    key: 'rzp_test_bZrV0YH9vSP3kB',
                                    amount: amount,
                                    currency: currency,
                                    order_id: orderId,
                                    description: 'Payment for your order',
                                    handler: async function (response) {
                                        await fetch('/updatedPayment', {
                                            method: 'post',
                                            headers: {
                                                'Content-Type': 'application/json',
                                            },
                                            body: JSON.stringify({
                                                paymentDetails: response,
                                                address: addressId,
                                                PaymentMethod: PaymentMethod
                                            })
                                        })

                                        window.location.href = '/success-page';
                                    },
                                    theme: {
                                        color: '#F37254'
                                    }
                                };

                                const rzp = new Razorpay(options);
                                rzp.open();

                            } catch (error) {
                                console.error(error);
                            }
                        } else if (response.status === 204) {

                            swal.fire({
                                title: 'Insufficient Balance',
                                text: 'You do not have enough funds in your wallet.',
                                icon: 'error',
                            });
                        }
                    } else {
                        await Swal.fire('error', 'Failed to place the order', 'error')
                    }

                } catch (error) {
                    console.log(error);
                }
            }
        }



    </script>


    <!-- Plugins JS File -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jquery.hoverIntent.min.js"></script>
    <script src="assets/js/jquery.waypoints.min.js"></script>
    <script src="assets/js/superfish.min.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="assets/js/main.js"></script>
    </body>

    <!-- molla/checkout.html  22 Nov 2019 09:55:06 GMT -->

    </html>