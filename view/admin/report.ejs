
<%- include('../partials/header') %>
<%- include('../partials/sidebar') %>
<head>  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head>

            <!-- Reports Section Start -->
            <div class="page-body">
                <!-- Container-fluid starts-->
                <div class="container-fluid">
                    <div class="row">
                        <!-- Salery Summy star-->
                        <div class="col-xl-8 col-lg-12 col-md-6">
                            <div class="card o-hidden">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Users Summary</h4>
                                    </div>
                                </div>
                                <div class="align-items-center">
                                    <button onclick="fetchUserCountData('monthly')">Monthly</button>
                                    <button onclick="fetchUserCountData('weekly')">Weekly</button>
                                    <button onclick="fetchUserCountData('yearly')">Yearly</button>
                                  </div>
                                  
                                  <canvas id="userCountChart" width="400" height="150"></canvas>
                                  
                               
                                 
                                  
                            </div>
                        </div>
                        <!-- Salery Summy end-->

                        <!-- Employ Salary  start-->
                        <div class="col-xl-4 col-lg-12 col-md-6">
                            <div class="h-100">
                                <div class="card o-hidden">
                                    <div class="card-header border-0 pb-1">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="card-header-title">
                                                <h4>Sales / Purchase</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="pie-chart">
                                            <div>
                                                <button onclick="changeInterval('monthly')">Monthly</button>
                                                <button onclick="changeInterval('weekly')">Weekly</button>
                                                <button onclick="changeInterval('yearly')">Yearly</button>
                                              </div>
                                              <canvas id="salesCountChart" width="400" height="325"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Employ Salary end-->

                        <!-- Expenses star-->
                        <!-- <div class="col-xl-4 col-lg-12 col-md-6">
                            <div class="card o-hidden">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Expenses</h4>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="expenses-cart"></div>
                                </div>
                            </div>
                        </div> -->
                        <!-- Expenses end-->

                        <!-- Sales / Purchase chart start -->
                        <!-- <div class="col-xl-8 col-lg-12 col-md-6">
                            <div class="card">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Sales / Purchase</h4>
                                    </div>
                                </div>
                               
                            </div>
                        </div> -->
                        <!-- Sales / Purchase chart end -->

                        <!-- Sales / Purchase Return star-->
                        <div class="col-12">
                            <div class="card o-hidden">
                                <!-- <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Sales / Purchase Return</h4>
                                    </div>
                                </div>
                                <div class="card-body p-0">
                                    <div id="sales-purchase-return-cart"></div>
                                </div> -->
                                <div class="card-header-title">
                                    <h4>Product / Sales</h4>
                                </div>
                                
                                <div class="align-items-center">
                                    <button onclick="fetchData('monthly')">Monthly</button>
                                    <button onclick="fetchData('weekly')">Weekly</button>
                                    <button onclick="fetchData('yearly')">Yearly</button>
                                  </div>
                                  <canvas id="revenueChart" width="400" height="150"></canvas>
                            </div>
                        </div>
                        <!-- Sales / Purchase Return end-->

                        <!-- Booking history start-->
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header border-0 pb-1">
                                    <div class="card-header-title">
                                        <h4>Transfer History</h4>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <div>
                                        <div class="table-responsive">
                                            <table class="user-table list-table table">
                                                <thead>
                                                   

                                                  
                                                    <tr>
                                                        <th>Transfer Id</th>
                                                        <th>Name</th>
                                                        <th>Date</th>
                                                        <th>Total</th>
                                                        <!-- <th>Options</th> -->
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    
                                                    <% orderData.map((order)=>{ %>
                                                    <tr>
                                                        <td><%= order._id.toString().substring(0, 6) %></td>
                                                        <td><%=order.address.name%></td>
                                                        <td><%=order.createdAt.toLocaleDateString()%></td>
                                                        <td>â‚¹<%=order.grandTotal%></td>
                                                        <td>
                                                            <ul>
                                                                <!-- <li>
                                                                    <a href="order-detail.html">
                                                                        <span class="ri-eye-line"></span>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="javascript:void(0)">
                                                                        <span class="lnr lnr-pencil"></span>
                                                                    </a>
                                                                </li>
                                                                <li>
                                                                    <a href="javascript:void(0)">
                                                                        <span class="lnr lnr-trash"></span>
                                                                    </a>
                                                                </li> -->
                                                            </ul>
                                                        </td>
                                                    </tr>
                                                    <% }) %>
                                                </tbody>
                                               
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Booking history  end-->
                    </div>
                </div>
                <!-- Container-fluid Ends-->

                <!-- footer start-->
                <div class="container-fluid">
                    <footer class="footer">
                        <div class="row">
                            <div class="col-md-12 footer-copyright text-center">
                                <p class="mb-0">Copyright 2022 Â© Fastkart theme by pixelstrap</p>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
            <!-- Reports Section End -->
        </div>
        <!-- Page Body End-->
    </div>
    <!-- page-wrapper End-->

    <canvas id="monthlyRevenueChart" width="400" height="400"></canvas>

    <!-- Modal Start -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="modal-title" id="staticBackdropLabel">Logging Out</h5>
                    <p>Are you sure you want to log out?</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <div class="button-box">
                        <button type="button" class="btn btn--no" data-bs-dismiss="modal">No</button>
                        <button type="button" class="btn  btn--yes btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal End -->

    <!-- latest js -->
    <script src="/assetsB/js/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap js -->
    <script src="/assetsB/js/bootstrap/bootstrap.bundle.min.js"></script>

    <!-- feather icon js -->
    <script src="/assetsB/js/icons/feather-icon/feather.min.js"></script>
    <script src="/assetsB/js/icons/feather-icon/feather-icon.js"></script>

    <!-- scrollbar simplebar js -->
    <script src="/assetsB/js/scrollbar/simplebar.js"></script>
    <script src="/assetsB/js/scrollbar/custom.js"></script>

    <!-- Sidebar js -->
    <script src="/assetsB/js/config.js"></script>

    <!-- tooltip init js -->
    <script src="/assetsB/js/tooltip-init.js"></script>

    <!-- Plugins js -->
    <script src="/assetsB/js/sidebar-menu.js"></script>
    <script src="/assetsB/js/notify/bootstrap-notify.min.js"></script>
    <script src="/assetsB/js/notify/index.js"></script>

    <!-- Apexchar js -->
    <script src="/assetsB/js/chart/apex-chart/apex-chart1.js"></script>
    <script src="/assetsB/js/chart/apex-chart/moment.min.js"></script>
    <script src="/assetsB/js/chart/apex-chart/apex-chart.js"></script>
    <script src="/assetsB/js/chart/apex-chart/stock-prices.js"></script>
    <script src="/assetsB/js/chart/apex-chart/chart-custom.js"></script>

    <!-- customizer js -->
    <script src="/assetsB/js/customizer.js"></script>

    <!-- ratio js -->
    <script src="/assetsB/js/ratio.js"></script>

    <!-- sidebar effect -->
    <script src="/assetsB/js/sidebareffect.js"></script>

    <!-- Theme js -->
    <script src="/assetsB/js/script.js"></script>

    <!-- chart js -->

    <script>
       let currentInterval = 'monthly'; // Initial time interval

function fetchData(interval) {
  currentInterval = interval;
  fetch(`/admin/${interval}-revenue`)
    .then(response => response.json())
    .then(data => {
      updateChart(data);
    })
    .catch(error => {
      console.error(`Error fetching ${interval} revenue:`, error);
    });
}

function updateChart(data) {
  const ctx = document.getElementById('revenueChart').getContext('2d');

  if (window.myChart) {
    window.myChart.destroy();
  }

  const chartColors = [
    'rgba(255, 99, 132, 0.5)',
    'rgba(54, 162, 235, 0.5)',
    'rgba(255, 206, 86, 0.5)',
    // Add more colors as needed
  ];

  const borderColor = [
    'rgba(255, 99, 132, 1)',
    'rgba(54, 162, 235, 1)',
    'rgba(255, 206, 86, 1)',
    // Add more colors as needed
  ];

  const config = {
    type: 'bar',
    data: {
      labels: data.map(item => item._id),
      datasets: [
        {
          label: `${currentInterval.charAt(0).toUpperCase() + currentInterval.slice(1)} Revenue`,
          data: data.map(item => item.totalRevenue),
          backgroundColor: chartColors.slice(0, data.length), // Using colors according to data length
          borderColor: borderColor.slice(0, data.length), // Using border colors according to data length
          borderWidth: 1
        }
      ]
    },
    options: {
      // Customize Chart.js options as needed
    }
  };

  window.myChart = new Chart(ctx, config);
}

fetchData('weekly'); // Initial chart render with 'weekly' data


  
let selectedInterval = 'monthly'; // Initial time interval
let salesChart = null; // Variable to store the chart instance

function changeInterval(interval) {
  selectedInterval = interval;
  retrieveData(interval);
}

function retrieveData(interval) {
  fetch(`/admin/${interval}-sales-count`)
    .then(response => response.json())
    .then(data => {
      renderSalesChart(data);
    })
    .catch(error => {
      console.error(`Error fetching ${interval} sales count:`, error);
    });
}

function renderSalesChart(data) {
  if (salesChart) {
    salesChart.destroy(); // Destroy the existing chart if it exists
  }

  const chartContext = document.getElementById('salesCountChart').getContext('2d');
  const chartConfig = {
    type: 'bar',
    data: {
      labels: data.map(item => item._id),
      datasets: [
        {
          label: `${selectedInterval.charAt(0).toUpperCase() + selectedInterval.slice(1)} Sales Count`,
          data: data.map(item => item.orders),
          backgroundColor: 'rgba(54, 162, 235, 0.2)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      // Customize Chart.js options as needed
    }
  };

  salesChart = new Chart(chartContext, chartConfig);
}

retrieveData(selectedInterval);


function fetchProductData(interval) {
  fetch('/admin/product-count-per-category')
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok.');
      }
      return response.json();
    })
    .then(data => {
      console.log(data); // Log the received data
      renderProductCountChart(data);
    })
    .catch(error => {
      console.error('Error fetching product count per category:', error);
    });
}

  

let userCountChart = null; // Store the chart instance

function fetchUserCountData(interval) {
  fetch(`/admin/user-counts?interval=${interval}`)
    .then(response => response.json())
    .then(data => {
      renderUserCountChart(data);
    })
    .catch(error => {
      console.error('Error fetching user count:', error);
    });
}

function renderUserCountChart(data) {
  const ctx = document.getElementById('userCountChart').getContext('2d');

  if (userCountChart) {
    userCountChart.destroy(); // Destroy the existing chart if it exists
  }

  const chartConfig = {
    type: 'line',
    data: {
      labels: data.map(item => item._id),
      datasets: [
        {
          label: 'Number of Users',
          data: data.map(item => item.userCount),
          backgroundColor: 'rgba(54, 162, 235, 0.5)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1,
        },
      ],
    },
    options: {
      // Customize Chart.js options as needed
    },
  };

  userCountChart = new Chart(ctx, chartConfig);
}

// Initial fetch for 'monthly' data
fetchUserCountData('weekly');



 

</script>

</body>


<!-- Mirrored from themes.pixelstrap.com/fastkart/back-end/reports.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 04 Sep 2023 05:49:49 GMT -->
</html>